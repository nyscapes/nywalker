<div class="row">
  <div class="col-md-6">
    <div class="pull-right">
      <img src="{{cover}}" class="img-thumbnail img-responsive" alt="{{cover_alt}}">
      <p><a href={{link}}>Google Books info</a></p>
    </div>
    <h1><em>{{title}}</em> {{{external_link}}}</h1>
    <h3>{{author}}, {{year}} <small>(isbn: {{isbn}})</small></h3>
    {{#permitted}}
    <a href="/books/{{slug}}/instances/new" class="btn btn-primary btn-default" role="button">Add instance</a>
    {{/permitted}}
    <h2>Instances:</h2>
    <table class="table table-hover">
      <thead>
        {{#permitted}}
          <th>&nbsp;</th>
        {{/permitted}}
        <th>Page</th>
        <th>Order</th>
        <th>Place</th>
        {{#permitted}}
          <th>&nbsp;</th>
        {{/permitted}}
      </thead>
      <tbody>
        {{#instances}}
        <tr>
          {{#permitted}}
            <td>
            {{#instance_permitted}}
              <a href="/books/{{slug}}/instances/{{instance_id}}/edit" class="btn btn-primary btn-small">Edit</a>
            {{/instance_permitted}}
            {{^instance_permitted}}
              {{owner}}
            {{/instance_permitted}}
            </td>
          {{/permitted}}
          <td>
            {{page}}
          </td>
          <td>
            {{sequence}}
          </td>
          <td>
            <a href="/places/{{place_slug}}/">{{place_name}}</a>
          </td>
          {{#permitted}}
            <td>
              {{#instance_permitted}}
                <form action="/books/{{slug}}/instances/{{instance_id}}/delete" method="POST">
                  <button role="button" type="submit" class="btn btn-danger btn-small">Delete</button>
                </form>
              {{/instance_permitted}}
              {{^instance_permitted}}
                &nbsp;
              {{/instance_permitted}}
            </td>
          {{/permitted}}
        </tr>
        {{/instances}}
        {{^instances}}
        <tr>
          <td colspan="3">No instances recorded, yet.</td>
        </tr>
        {{/instances}}
      </tbody>
    </table>

  </div>
  <div class="col-md-6">
    <div id="map">
    </div>
  </div>
</div>

<script>
  var map = L.map('map').setView([0,0], 15);
  var baseLayer = L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map);
  var dots = L.markerClusterGroup();
   {{#places}}
     dots.addLayer(L.circleMarker([{{lat}}, {{lon}}]).bindPopup("{{name}}"));
   {{/places}}
   map.addLayer(dots);
   map.fitBounds(dots.getBounds());
 </script>
